{
    # Global options
    admin off
    auto_https off
}

# Development configuration without SSL
:80 {
    # Logging
    log {
        output stdout
        format json
    }
    
    # API reverse proxy
    handle /api/* {
        reverse_proxy api:8000 {
            header_up Host {host}
            header_up X-Real-IP {remote}
            header_up X-Forwarded-For {remote}
            header_up X-Forwarded-Proto {scheme}
        }
    }
    
    # Health check endpoint
    handle /health {
        reverse_proxy api:8000
    }
    
    # Documentation endpoints (if enabled)
    handle /docs* {
        reverse_proxy api:8000
    }
    
    handle /redoc* {
        reverse_proxy api:8000
    }
    
    # MinIO proxy (optional)
    handle /minio* {
        reverse_proxy minio:9000
    }
    
    # For all other paths, return 404
    handle {
        respond "Not Found" 404
    }
}

# Production configuration with SSL - uncomment and modify for production
# yourdomain.com {
#     tls {
#         protocols tls1.2 tls1.3
#         # Automatic HTTPS with Let's Encrypt
#     }
# 
#     # Logging
#     log {
#         output stdout
#         format json
#     }
#     
#     # Compression
#     encode gzip zstd
#     
#     # Security headers
#     header {
#         # Enable HTTP Strict Transport Security (HSTS)
#         Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
#         # Disable content-type sniffing
#         X-Content-Type-Options "nosniff"
#         # XSS Protection
#         X-XSS-Protection "1; mode=block"
#         # Clickjacking protection
#         X-Frame-Options "DENY"
#         # Content Security Policy
#         Content-Security-Policy "default-src 'self'; frame-ancestors 'none'"
#         # Referrer Policy
#         Referrer-Policy "no-referrer-when-downgrade"
#     }
#
#     # API reverse proxy
#     handle /api/* {
#         reverse_proxy api:8000 {
#             header_up Host {host}
#             header_up X-Real-IP {remote}
#             header_up X-Forwarded-For {remote}
#             header_up X-Forwarded-Proto {scheme}
#         }
#     }
#     
#     # Health check endpoint
#     handle /health {
#         reverse_proxy api:8000
#     }
#     
#     # For all other paths, return 404
#     handle {
#         respond "Not Found" 404
#     }
# }